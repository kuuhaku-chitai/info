# 空白地帯 - Cloudflare Workers 設定
#
# production / preview の2環境でデプロイ。
# Next.js は opennextjs-cloudflare でビルドし Workers 上で実行する。
# D1 は REST API、R2 はバインディングで接続。

name = "kuuhaku-chitai"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

# opennextjs-cloudflare のビルド出力
main = ".open-next/worker.js"

[assets]
directory = ".open-next/assets"
binding = "ASSETS"

# ============================================
# Production 環境（デフォルト）
# ============================================

[[d1_databases]]
binding = "DB"
database_name = "kuuhaku-chitai-db"
database_id = "4774b053-1bf8-4cad-9f36-0a58bc795acb"

[[r2_buckets]]
binding = "R2"
bucket_name = "kuuhaku-chitai-images"

[vars]
CLOUDFLARE_ACCOUNT_ID = "a590dc6b80716813a416b67ad0a9d02c"
CLOUDFLARE_D1_DATABASE_ID = "4774b053-1bf8-4cad-9f36-0a58bc795acb"
R2_BUCKET_NAME = "kuuhaku-chitai-images"
R2_PUBLIC_URL = "https://pub-6e801ebf925647f3b90e1cd4e38d766f.r2.dev"
NEXT_PUBLIC_BASE_URL = "https://kuuhaku-chitai.net"
# Turnstile Site Key（Cloudflareダッシュボードで作成後に設定）
NEXT_PUBLIC_TURNSTILE_SITE_KEY = "0x4AAAAAACcR2K-SFVedsnWU"

[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1

# ============================================
# Preview 環境
# ============================================

[env.preview]
name = "kuuhaku-chitai-preview"

[[env.preview.d1_databases]]
binding = "DB"
database_name = "kuuhaku-chitai-db-preview"
database_id = "efe9e479-5479-4df8-b5ba-07f40174a6a0"

[[env.preview.r2_buckets]]
binding = "R2"
bucket_name = "kuuhaku-chitai-images-preview"

[env.preview.vars]
CLOUDFLARE_ACCOUNT_ID = "a590dc6b80716813a416b67ad0a9d02c"
CLOUDFLARE_D1_DATABASE_ID = "efe9e479-5479-4df8-b5ba-07f40174a6a0"
R2_BUCKET_NAME = "kuuhaku-chitai-images-preview"
R2_PUBLIC_URL = "https://pub-77167c0c98424bcf8f768950cee388b3.r2.dev"
NEXT_PUBLIC_BASE_URL = "https://preview.kuuhaku-chitai.net"
NEXT_PUBLIC_TURNSTILE_SITE_KEY = "0x4AAAAAACcR2K-SFVedsnWU"

# ============================================
# ローカル開発設定
# ============================================

[dev]
port = 8787
